
# 用户需求文档 (URD): “AI亲情画板”项目

| 文档版本 | v1.1 |
| :--- | :--- |
| **更新日期** | 2025年9月3日 |
| **项目名称** | AI亲情画板 (AI Family Palette) |
| **核心技术** | Google Nano Banana 模型, Streamlit |

-----

## 1\. 文档引言

### 1.1 项目背景

随着生成式AI技术的普及，文生图工具层出不穷，但其复杂的操作界面和专业术语往往让非技术背景的用户（尤其是长辈）望而却步。本项目旨在利用Google先进的、具备上下文理解能力的`Nano Banana`文生图模型，开发一个极简、有趣、充满互动性的图片生成Web应用。

此项目为开源项目，旨在让任何有基本编程能力的开发者，都能轻松地为自己的亲友部署一个专属的、安全的AI绘画工具，作为一份独特的科技礼物。

### 1.2 项目目标

  - **目标一 (易用性):** 为非技术用户提供一个无需学习、“零压力”的图片生成与修改界面。
  - **目标二 (趣味性):** 实现基于自然语言对话的连续图片编辑功能，将用户体验从“生成”升级为“共同创作”。
  - **目标三 (安全性与私密性):** 通过用户认证系统，确保应用仅限授权用户访问，并保护管理员的API密钥安全。
  - **目标四 (可复用性):** 以开源形式发布，提供清晰的配置和部署指南，使其他开发者可以轻松为自己的圈子创建实例。

### 1.3 目标用户

本项目主要服务于两类用户：

  - **最终用户 (End-User):**
      - **描述:** 技术背景较弱的亲人或朋友（以“妈妈”为典型代表）。
      - **诉求:** 想要一个好玩、简单、能创造并分享精美图片的工具。
  - **管理员 (Administrator/Developer):**
      - **描述:** 具备基本Python和部署知识的程序员（即您本人，以及其他使用此开源项目的开发者）。
      - **诉求:** 需要一个易于配置和部署，且能安全管理用户和API密钥的系统。

-----

## 2\. 用户画像与使用场景

### 2.1 用户画像 (Persona): “爱分享的妈妈”

  - **基本信息:** 50-65岁，退休或半退休状态，乐于尝试新鲜事物。
  - **技术能力:** 熟练使用智能手机和微信等社交App，但对电脑操作、软件安装、复杂设置感到困难。主要上网设备是手机或平板。
  - **行为习惯:** 热衷于在家庭群和朋友圈分享生活、趣闻和精美图片。享受创造带来的成就感和社交货币。
  - **核心痛点:** 觉得AI绘画很神奇，但现有工具太复杂，不知道从何入手。
  - **使用动机:** “这是我孩子专门为我做的，真好玩！”、“我要用这个做个好看的图片当头像/发给朋友们看看。”

### 2.2 典型使用场景

**场景一：初次体验**
女儿把一个链接和用户名密码发给妈妈。妈妈在手机上点开链接，进入一个简洁的登录页面。输入信息后，她看到了一个充满亲切感的欢迎界面和一个大大的“开始画画”按钮。她好奇地点了一下，几秒钟后，一张可爱的香蕉图片出现了。

**场景二：互动创作**
图片虽然可爱，但妈妈想：“要是它戴顶帽子就好了”。她看到图片下方有个输入框，提示她可以“指挥AI修改”，旁边还有个「加个配饰🎩」的按钮。她试着输入“给它戴一顶蓝色的礼帽”，很快，图片上的香蕉真的戴上了一顶漂亮的蓝帽子。她感到非常惊喜和有趣。

**场景三：保存与分享**
经过几轮对话修改，妈妈得到了一张非常满意的图片。她点击图片下方醒目的“下载图片”按钮，图片顺利保存到手机相册。随后，她开心地把这张“杰作”发到了家庭群里，并骄傲地宣布这是她用女儿做的工具画的。

**场景四：再次访问**
第二天，妈妈想再做一张图片，她再次点开那个链接，发现页面直接进入了主界面，无需再次登录，这让她感觉非常方便。

-----

## 3\. 用户需求详述 (URD)

### 3.1 功能性需求 (Functional Requirements)

| 需求ID | 模块 | 需求描述 | 优先级 |
| :--- | :--- | :--- | :--- |
| **FR-001** | 用户认证 | 系统必须提供一个登录页面，用户需要通过预设的用户名和密码进行认证。 | **高** |
| **FR-002** | 用户管理 | 管理员必须能够通过后端配置文件（如 `secrets.toml`）预设和管理用户信息（用户名、显示名称、加密后的密码）。 | **高** |
| **FR-003** | API密钥管理 | 管理员的Google API Key必须安全地存储在后端配置文件中，不得暴露给前端。 | **高** |
| **FR-004** | 会话保持 | 系统必须支持“记住我”功能（通过Cookie实现），用户在设定有效期内再次访问无需重复登录。 | **高** |
| **FR-005** | 初始图片生成 | 登录后，用户可以通过点击一个明确的按钮来触发首次图片生成。 | **高** |
| **FR-006** | 对话式编辑 | 在图片生成后，用户必须能够通过文本输入，对当前图片进行连续的、有上下文的修改。 | **高** |
| **FR-007** | 快捷指令 | 界面需提供若干预设的快捷指令按钮，帮助用户轻松地进行常见修改，降低输入门槛。 | **高** |
| **FR-008** | 对话历史展示 | 界面必须清晰地展示用户与AI的对话历史，以提供上下文参考。 | **高** |
| **FR-009** | 状态重置 | 用户必须能够通过一个“重新开始”按钮，随时清除当前对话和图片，发起一次全新的创作。 | **高** |
| **FR-010** | 图片下载 | 用户必须能够一键下载当前生成的图片到本地设备。 | **高** |
| **FR-011** | (新增) 对话上下文窗口 | 管理员必须能够在后端配置文件中，设定一个整数值作为“上下文窗口宽度”（例如6），系统在调用API时仅传递最近N轮的对话历史。 | **中** |

### 3.2 非功能性需求 (Non-Functional Requirements)

| 需求ID | 类型 | 需求描述 |
| :--- | :--- | :--- |
| **NFR-001** | **易用性** | 界面设计必须极度简洁，色彩明快，字体清晰。所有交互元素必须直观易懂，无需任何教程或说明。 |
| **NFR-002** | **移动优先** | 应用必须在移动设备（手机、平板）的浏览器上完美显示和运行。 |
| **NFR-003** | **安全性** | 密码必须经过哈希加密后存储。API密钥和用户凭证在传输和存储过程中必须是安全的。 |
| **NFR-004** | **(更新) 性能与可靠性** | - **加载提示:** 图片生成期间必须有明确的加载提示（如“正在为您绘画...”）。\<br\>- **自动重试:** 在API调用失败时，系统应在内部进行有限次数的自动重试。\<br\>- **友好错误处理:** 若重试后依然失败，系统必须向用户展示一个简单友好的提示（如“网络好像开小差了，请稍后再试”），而非技术性错误代码。 |
| **NFR-005** | **(更新) 可部署性** | - **清晰文档:** 项目代码结构应清晰，并提供详细的`README.md`文件，指导其他开发者如何配置`secrets.toml`和部署应用。\<br\>- **成本风险提示:** `README.md`文件中必须明确提示管理员，API调用会产生费用，并建议其在云服务商处设置预算告警。 |

-----

## 4\. 用户行为流程 (User Behavior Flow)

1.  **访问应用**: 用户通过URL访问应用。
2.  **身份验证**:
      - `IF` Cookie有效 `THEN` 自动登录，跳转至 **步骤3**。
      - `ELSE` 显示登录页面 -\> 用户输入用户名/密码 -\> 系统验证 -\> `IF` 成功 `THEN` 设置Cookie，跳转至 **步骤3** `ELSE` 显示错误提示。
3.  **主界面 (初始态)**:
      - 显示欢迎语（例如“欢迎您，\<用户昵称\>！”）。
      - 显示一个核心的“开始创作”按钮。
4.  **生成第一张图**:
      - 用户点击“开始创作”按钮。
      - 系统显示加载动画 -\> 后端调用AI API -\> 返回图片。
5.  **主界面 (创作态)**:
      - 显示生成的图片。
      - 显示对话历史区域。
      - 显示文本输入框和快捷指令按钮。
      - 显示“下载图片”和“重新开始”按钮。
6.  **进行对话式修改**:
      - 用户输入文本或点击快捷按钮。
      - 系统显示加载动画 -\> 后端将符合上下文窗口宽度的对话历史发送至AI API -\> 返回新图片。
      - 页面更新，显示新图片和更新后的对话历史 -\> **循环此步骤**。
7.  **结束或中断流程**:
      - **下载**: 用户点击“下载图片”按钮，触发浏览器下载。
      - **重置**: 用户点击“重新开始”按钮，清空会话状态，返回 **步骤3**。
      - **退出**: 用户关闭浏览器标签页。

-----

## 5\. MVP范围定义 (MVP Scope Definition)

### 范围内 (In-Scope):

  - 完整的用户登录、登出及会话保持功能。
  - 基于配置文件的管理员用户和API Key管理。
  - 单轮及多轮对话式图片生成与修改。
  - 可由管理员配置的对话上下文长度。
  - 简洁的对话历史展示。
  - 快捷指令按钮辅助输入。
  - 图片下载与重新开始功能。
  - 友好的错误处理与API调用重试机制。

### 范围外 (Out-of-Scope for v1.1):

  - 用户自行注册功能。
  - 忘记密码/密码重置功能。
  - 管理员的图形化管理后台（所有管理均通过配置文件）。
  - 历史创作的图片画廊或保存功能。
  - 多用户使用不同的API Key。
  - 社交分享接口的直接集成（MVP仅支持下载后手动分享）。
  - 撤销上一步操作的功能。